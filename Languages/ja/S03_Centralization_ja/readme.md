---
title: S03. 中央集権化リスク
tags:
  - solidity
  - security
  - multisig
---

# WTF Solidity 合約セキュリティ: S03. 中央集権化リスク

私は最近Solidityを学び直して詳細を固めており、「WTF Solidity 合約セキュリティ」を書いています。初心者向けの内容で（プログラミング上級者は他のチュートリアルをお探しください）、毎週1-3講座を更新しています。

Twitter：[@0xAA_Science](https://twitter.com/0xAA_Science)｜[@WTFAcademy_](https://twitter.com/WTFAcademy_)

コミュニティ：[Discord](https://discord.gg/5akcruXrsk)｜[微信群](https://docs.google.com/forms/d/e/1FAIpQLSe4KGT8Sh6sJ7hedQRuIYirOoZK_85miz3dw7vA1-YjodgJ-A/viewform?usp=sf_link)｜[公式サイト wtf.academy](https://wtf.academy)

すべてのコードとチュートリアルはgithubでオープンソース化されています：[github.com/AmazingAng/WTF-Solidity](https://github.com/AmazingAng/WTF-Solidity)

---

今回は、スマートコントラクトにおける中央集権化と偽分散化がもたらすリスクについて紹介します。`Ronin`ブリッジと`Harmony`ブリッジはこの脆弱性によりハッカーの攻撃を受け、それぞれ6.24億ドルと1億ドルを盗まれました。

## 中央集権化リスク

私たちはよくWeb3の分散化を誇りに思い、Web3.0の世界では所有権と制御権がすべて分散化されていると考えています。しかし実際には、中央集権化はWeb3プロジェクトで最も一般的なリスクの一つです。著名なブロックチェーン監査会社Certikは[2021年DeFiセキュリティレポート](https://f.hubspotusercontent40.net/hubfs/4972390/Marketing/defi%20security%20report%202021-v6.pdf)で次のように指摘しています：

> 中央集権化リスクはDeFiで最も一般的な脆弱性であり、2021年には44回のDeFiハッキング攻撃がこれと関連し、ユーザー資金の損失は13億ドルを超えました。これは分散化の重要性を強調しており、多くのプロジェクトがまだこの目標の実現に向けて努力する必要があります。

中央集権化リスクとは、スマートコントラクトの所有権が中央集権化されていることを指します。例えば、コントラクトの`owner`が一つのアドレスによって制御され、コントラクトのパラメータを自由に変更したり、ユーザー資金を引き出したりできる状況です。中央集権化されたプロジェクトには単一障害点のリスクがあり、悪意のある開発者（内部犯行）やハッカーに利用される可能性があります。制御権限を持つアドレスの秘密鍵を取得された後、`rug-pull`、無限ミント、その他の手法で資金を盗むことができます。

チェーンゲームプロジェクト`Vulcan Forged`は2021年12月に秘密鍵の漏洩により1.4億ドルを盗まれ、DeFiプロジェクト`EasyFi`は2021年4月に秘密鍵の漏洩により5900万ドルを盗まれ、DeFiプロジェクト`bZx`はフィッシング攻撃で秘密鍵が漏洩し5500万ドルを盗まれました。

## 偽分散化リスク

偽分散化のプロジェクトは通常、外部に対して自分たちが分散化されていると宣伝していますが、実際には中央集権化プロジェクトと同様に単一障害点のリスクを抱えています。例えば、マルチシグウォレットを使用してスマートコントラクトを管理しているが、複数のマルチシグ参加者が一致行動者で、背後では一人によって制御されている場合です。このようなプロジェクトは非常に分散化されているように包装されているため、投資家の信頼を得やすく、そのためハッキング事件が発生した際の被害額も往々にして大きくなります。

近年爆発的に人気となったチェーンゲームプロジェクトAxieのRoninチェーンクロスチェーンブリッジプロジェクトは、2022年3月に6.24億ドルを盗まれ、これは史上最大の被害額を記録した事件です。Roninクロスチェーンブリッジは9つのバリデーターによって維持され、預金と引き出し取引を承認するには5人の合意が必要でした。これはマルチシグのようで、非常に分散化されているように見えました。しかし実際には、そのうち4つのバリデーターはAxieの開発会社Sky Mavisによって制御され、さらにAxie DAOによって制御されている別の1つのバリデーターもSky Mavisバリデーターノードが代理で取引に署名することを承認していました。そのため、攻撃者がSky Mavisの秘密鍵を取得した後（具体的な方法は未公開）、5つのバリデーターノードを制御し、173,600 ETHと2550万USDCの盗取を承認することができました。さらに、2023年8月1日には、PEPEマルチシグウォレットが閾値を`5/8`から僅か`2/8`に変更し、マルチシグアドレスから大量のPEPEを転出しました。これも偽分散化の表れです。

`Harmony`公開チェーンのクロスチェーンブリッジは2022年6月に1億ドルを盗まれました。`Harmony`ブリッジは5つのマルチシグ参加者によって制御され、非常に驚くべきことに、そのうち2人の署名だけで取引を承認できました。ハッカーが2つのマルチシグ参加者の秘密鍵を盗取することに成功した後、ユーザーがステーキングした資産を空にしました。

![](./img/S03-1.png)

## 脆弱性コントラクトの例

中央集権化リスクを持つコントラクトは多種多様ですが、ここでは最も一般的な例を一つ挙げます：`owner`アドレスが任意にトークンをミントできる`ERC20`コントラクトです。プロジェクトの内部犯行者やハッカーが`owner`の秘密鍵を取得した後、無限にコインをミントでき、投資家に大きな損失をもたらします。

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.21;

import "@openzeppelin/contracts/token/ERC20/ERC20.sol";
import "@openzeppelin/contracts/access/Ownable.sol";

contract Centralization is ERC20, Ownable {
    constructor() ERC20("Centralization", "Cent") {
        address exposedAccount = 0xe16C1623c1AA7D919cd2241d8b36d9E79C1Be2A2;
        transferOwnership(exposedAccount);
    }

    function mint(address to, uint256 amount) external onlyOwner{
        _mint(to, amount);
    }
}
```

## 中央集権化/偽分散化リスクを減らす方法は？

1. マルチシグウォレットを使用して国庫を管理し、コントラクトパラメータを制御する。効率性と分散化を両立させるため、4/7または6/9マルチシグを選択できます。マルチシグウォレットについて詳しく知らない場合は、[WTF Solidity 第50講：マルチシグウォレット](https://github.com/AmazingAng/WTF-Solidity/blob/main/50_MultisigWallet/readme.md)をお読みください。

2. マルチシグの保有者を多様化し、創設チーム、投資家、コミュニティリーダーの間に分散させ、相互に署名を委任しないようにする。

3. タイムロックを使用してコントラクトを制御し、ハッカーやプロジェクト内部犯行者がコントラクトパラメータを変更/資産を盗取する際に、プロジェクト側とコミュニティが対応する時間を確保し、損失を最小限に抑える。タイムロックコントラクトについて詳しく知らない場合は、[WTF Solidity 第45講：タイムロック](https://github.com/AmazingAng/WTF-Solidity/blob/main/45_Timelock/readme.md)をお読みください。

## まとめ

中央集権化/偽分散化は、ブロックチェーンプロジェクトの最大のリスクであり、近年でユーザー資金の損失は20億ドルを超えています。中央集権化リスクはコントラクトコードを分析することで発見できますが、偽分散化リスクはより深く隠されており、プロジェクトに対する詳細なデューデリジェンスを行って初めて発見できます。